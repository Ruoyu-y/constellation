[Unit]
Description=Configures constellation cloud service provider environment variable

[Service]
Type=oneshot
ExecStart=/bin/bash -c "CSP=$(< /proc/cmdline tr  ' ' '\n' | grep constel.csp | sed 's/constel.csp=//'); echo CONSTEL_CSP=$CSP >> /run/constellation.env"
ExecStart=/bin/bash -c "ATTESTATION=$(< /proc/cmdline tr  ' ' '\n' | grep constel.attestation-variant | sed 's/constel.attestation-variant=//'); echo CONSTEL_ATTESTATION_VARIANT=$ATTESTATION >> /run/constellation.env"
ExecStart=/bin/bash -c "echo http_proxy=http://child-prc.intel.com:913/ >> /run/constellation.env"
ExecStart=/bin/bash -c "echo https_proxy=http://child-prc.intel.com:913/ >> /run/constellation.env"
ExecStart=/bin/bash -c "echo no_proxy=localhost,127.0.0.1,.intel.com,.svc,192.168.0.0/16,10.0.0.0/8,172.10.0.0/16,172.11.0.0/16 >> /run/constellation.env"
ExecStart=/bin/bash -c "echo HTTP_PROXY=http://child-prc.intel.com:913/ >> /run/constellation.env"
ExecStart=/bin/bash -c "echo HTTPS_PROXY=http://child-prc.intel.com:913/ >> /run/constellation.env"
ExecStart=/bin/bash -c "echo NO_PROXY=localhost,127.0.0.1,.intel.com,.svc,192.168.0.0/16,10.0.0.0/8,172.10.0.0/16,172.11.0.0/16 >> /run/constellation.env"
RemainAfterExit=yes

[Install]
WantedBy=basic.target
